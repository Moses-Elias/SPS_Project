<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Science Bot</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f5;
      padding: 20px;
    }
    #chat {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
      max-width: 700px;
      margin: 0 auto;
      height: 400px;
      overflow-y: auto;
    }
    .msg { margin: 10px 0; }
    .user { font-weight: bold; }
    .bot { color: green; }
    input, select, button {
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    #input-area {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
  </style>
</head>
<body>

<h2 style="text-align:center">ðŸ”¬ Science Bot</h2>

<div style="text-align: center; margin-bottom: 10px;">
  <label for="subject">Subject:</label>
  <select id="subject">
    <option value="general">General</option>
    <option value="biology">Biology</option>
    <option value="chemistry">Chemistry</option>
    <option value="physics">Physics</option>
    <option value="earth science">Earth Science</option>
  </select>
  <label style="margin-left: 10px;">
    <input type="checkbox" id="quizMode"> Quiz Mode
  </label>
</div>

<div id="chat"></div>
<div id="input-area">
  <input type="text" id="user-input" placeholder="Type a message..." style="flex: 1; min-width: 300px;" />
  <button onclick="sendMessage()">Send</button>
</div>

<script>
  const chatDiv = document.getElementById('chat');
  const input = document.getElementById('user-input');
  let history = JSON.parse(localStorage.getItem('chatHistory') || '[]');

  // System instruction - not always sent
  const systemPrompt = `
You are Science Bot, a teacher who helps high school students with science topics. 
Answer questions clearly, directly, and concisely. Avoid unnecessary details or explanations. 
Use examples where necessary, but keep answers short and to the point. 
Be encouraging but donâ€™t add any filler or unrelated info.
`;


  function displayMessage(role, text) {
    const msgHTML = `<div class="msg ${role === 'user' ? 'user' : 'bot'}">${role === 'user' ? 'ðŸ‘¤ You' : 'ðŸ¤– Science Bot'}: ${text}</div>`;
    chatDiv.innerHTML += msgHTML;
    chatDiv.scrollTop = chatDiv.scrollHeight;
  }

  function restoreChat() {
    history.forEach(msg => displayMessage(msg.role, msg.content));
  }

  async function sendMessage() {
    const userMessage = input.value.trim();
    if (!userMessage) return;
    input.value = "";

    displayMessage('user', userMessage);
    history.push({ role: 'user', content: userMessage });
    localStorage.setItem('chatHistory', JSON.stringify(history));

    // Trim to last 3 messages + prompt
    const prompt = `${systemPrompt}\nUser: ${userMessage}\nScience Bot:`;

    const response = await fetch('http://localhost:11434/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'llama3',
        prompt,
        stream: false
      })
    });

    const result = await response.json();
    const botReply = result.response.trim();

    displayMessage('assistant', botReply);
    history.push({ role: 'assistant', content: botReply });
    localStorage.setItem('chatHistory', JSON.stringify(history));
  }

  // Restore previous session
  restoreChat();
</script>

</body>
</html>
