import{S as P,b as T,e as H,n as S,f as y,g as v,h as R,I as j,J as F,U as q,o as I,W as J,X as W,p as g,j as _,H as U,t as M,k as d,at as k,a6 as C,as as X,a3 as z}from"./global-CUTJa-Jf.js";function L(i,t,e){const s=i.slice();return s[8]=t[e],s}function N(i){let t,e,s,n,f=i[0].sendmail+"",l,o,c,r,b=[],u=new Map,h=q(["to","cc","bcc"]);const p=a=>a[8];for(let a=0;a<3;a+=1){let m=L(i,h,a),w=p(m);u.set(w,b[a]=B(w,m))}return{c(){t=_("div"),e=_("button"),s=_("i"),n=U(),l=M(f),c=U(),r=_("div");for(let a=0;a<3;a+=1)b[a].c();d(s,"class","fa fa-envelope-o mr-1"),d(s,"aria-hidden","true"),d(e,"type","button"),d(e,"class","btn btn-outline-secondary text-dark bg-white dropdown-toggle"),d(e,"data-toggle","dropdown"),d(e,"data-bs-toggle","dropdown"),d(e,"aria-expanded","false"),e.disabled=o=!i[1].length,d(r,"class","dropdown-menu"),d(t,"class","btn-group ml-2 my-2")},m(a,m){v(a,t,m),g(t,e),g(e,s),g(e,n),g(e,l),g(t,c),g(t,r);for(let w=0;w<3;w+=1)b[w]&&b[w].m(r,null)},p(a,m){m&1&&f!==(f=a[0].sendmail+"")&&I(l,f),m&2&&o!==(o=!a[1].length)&&(e.disabled=o),m&7&&(h=q(["to","cc","bcc"]),b=J(b,m,p,1,a,h,u,r,W,B,null,L))},d(a){a&&y(t);for(let m=0;m<3;m+=1)b[m].d()}}}function B(i,t){let e,s=t[0][t[8]]+"",n,f,l;return{key:i,first:null,c(){e=_("a"),n=M(s),f=U(),d(e,"class","dropdown-item"),d(e,"href",l=k(t[2].id,t[1],t[8])),this.first=e},m(o,c){v(o,e,c),g(e,n),g(e,f)},p(o,c){t=o,c&1&&s!==(s=t[0][t[8]]+"")&&I(n,s),c&6&&l!==(l=k(t[2].id,t[1],t[8]))&&d(e,"href",l)},d(o){o&&y(e)}}}function A(i){let t,e=i[2]&&N(i);return{c(){e&&e.c(),t=R()},m(s,n){e&&e.m(s,n),v(s,t,n)},p(s,[n]){s[2]?e?e.p(s,n):(e=N(s),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:S,o:S,d(s){s&&y(t),e&&e.d(s)}}}function G(i,t,e){let s,{strings:n}=t,{courses:f}=t,{userid:l}=t,{courseid:o}=t,{form:c}=t,r=[];j(async()=>{(await C("core/pubsub")).subscribe("core/checkbox-toggleall:checkboxToggled",b),b()}),F(async()=>{(await C("core/pubsub")).unsubscribe("core/checkbox-toggleall:checkboxToggled",b)});const b=async()=>{e(1,r=[]);const u=new FormData(c);for(const h of u.keys()){const p=/^user(\d+)$/.exec(h);if(p){const a=parseInt(p[1]);a!=l&&r.push(a)}}};return i.$$set=u=>{"strings"in u&&e(0,n=u.strings),"courses"in u&&e(3,f=u.courses),"userid"in u&&e(4,l=u.userid),"courseid"in u&&e(5,o=u.courseid),"form"in u&&e(6,c=u.form)},i.$$.update=()=>{i.$$.dirty&40&&e(2,s=f.find(u=>u.id==o))},[n,r,s,f,l,o,c]}class K extends P{constructor(t){super(),T(this,t,G,A,H,{strings:0,courses:3,userid:4,courseid:5,form:6})}}function D(i){let t,e,s,n=i[1].sendmail+"",f,l;return{c(){t=_("a"),e=_("i"),s=U(),f=M(n),d(e,"class","fa fa-envelope-o mr-1"),d(e,"aria-hidden","true"),d(t,"class","btn"),d(t,"role","button"),d(t,"href",l=k(i[3],[i[2]],"to"))},m(o,c){v(o,t,c),g(t,e),g(t,s),g(t,f)},p(o,c){c&2&&n!==(n=o[1].sendmail+"")&&I(f,n),c&12&&l!==(l=k(o[3],[o[2]],"to"))&&d(t,"href",l)},d(o){o&&y(t)}}}function O(i){let t,e=i[2]!=i[0]&&i[4]&&D(i);return{c(){e&&e.c(),t=R()},m(s,n){e&&e.m(s,n),v(s,t,n)},p(s,[n]){s[2]!=s[0]&&s[4]?e?e.p(s,n):(e=D(s),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:S,o:S,d(s){s&&y(t),e&&e.d(s)}}}function Q(i,t,e){let s,{userid:n}=t,{strings:f}=t,{courses:l}=t,{id:o}=t,{courseid:c}=t;return i.$$set=r=>{"userid"in r&&e(0,n=r.userid),"strings"in r&&e(1,f=r.strings),"courses"in r&&e(5,l=r.courses),"id"in r&&e(2,o=r.id),"courseid"in r&&e(3,c=r.courseid)},i.$$.update=()=>{i.$$.dirty&40&&e(4,s=l.find(r=>r.id==c))},[n,f,o,c,s,l]}class V extends P{constructor(t){super(),T(this,t,Q,O,H,{userid:0,strings:1,courses:5,id:2,courseid:3})}}async function Y(){const i=window.local_mail_navbar_data;if(!i)return;Z(i);const t=window.location.origin+window.location.pathname,e=new URLSearchParams(window.location.search);t==window.M.cfg.wwwroot+"/user/view.php"?x(i,parseInt(e.get("id")||""),parseInt(e.get("course")||"")):t==window.M.cfg.wwwroot+"/user/index.php"?E(i,parseInt(e.get("id")||"")):t==window.M.cfg.wwwroot+"/blocks/completion_progress/overview.php"&&E(i,parseInt(e.get("courseid")||""))}function Z(i){const t=document.getElementById("local-mail-navbar");if(t){t.innerHTML="";const e=new X({target:t,props:{settings:i.settings,strings:i.strings,courses:i.courses,labels:i.labels,params:{courseid:i.courseid},loading:!1,onClick:s=>{window.location.href=z(s)},onComposeClick:s=>{window.location.href=k(s)},onCourseChange:s=>{e.$set({params:{courseid:s}})}}})}}function E(i,t){var n;const e=(n=document.querySelector("#formactionid"))==null?void 0:n.parentElement,s=document.querySelector("#participantsform");t&&e&&s&&new K({target:e,props:{userid:i.userid,strings:i.strings,courses:i.courses,courseid:t,form:document.querySelector("#participantsform")}})}function x(i,t,e){const s=document.querySelector(".userprofile .page-context-header");if(t&&e&&s){let n=s.querySelector(".header-button-group");n||(n=document.createElement("div"),n.classList.add("btn-group","header-button-group"),s.append(n)),new V({target:n,props:{userid:i.userid,strings:i.strings,courses:i.courses,id:t,courseid:e}})}}Y();
//# sourceMappingURL=navigation-qxMtMryf.js.map
